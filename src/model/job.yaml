# Initial hypothetical type of job:
#
# Unlike manifests which actually verify data *against* well-defined
# schemata, the job manifest is explicitly data in and of itself,
# verified against this schema. The aim is to generate JSON-LD or RDF
# from this schema + manifest, which is then processed by the RAP.
#
# Here is what the LinkML documentation says:
# [https://linkml.io/linkml/faq/general.html#is-linkml-just-for-metadata]
#
#' "LinkML doesn’t draw any hard and fast distinction between data and
#' metadata, recognizing that “metadata” is often defined in relative
#' terms."
#
id: http://localhost/saved/job/
name: job
title: >-
  SAVED data model: job template specification
prefixes:
  dc:      http://purl.org/dc/elements/1.1/
  dcterms: http://purl.org/dc/terms/
  linkml:  https://w3id.org/linkml/
  pav:     http://purl.org/pav/
  saved:   http://localhost/saved/
imports:
  - linkml:types
default_prefix: saved
default_range:  string  

slots:
  
  atomic_name:
    description: >-
      Short-form name / atom: lower-case, no special characters excepting underscores
    range:           string
    broad_mappings:
      - saved:name
      - dc:title
    pattern:         "^:?[a-z]+[[a-z]|_|]*$"
    exact_mappings:  dc:identifier
    identifier:      true
    required:        true

  # Not from linkml:types, only in linkml:meta and linkml:datasets
  # Note, linkml:datasets is *not* imported by linkml:meta
  #
  # These are essentially duplicates of terms in Dublin Core,
  # so it is fairly reasonable to duplicate these here too, instead of importing
  # the entire linkml:meta or linkml:datasets
  #
  # Further emphasise once again that job.yaml is being used as the
  # schema for our job manifests, see comment at top of file.
  title:
    description: >-
      A concise human-readable display label for the element. The title should mirror the name,
      and should use ordinary textual punctuation.
    range:           string
    slot_uri:        dcterms:title

  description:
    description:     Human-readable description of the information
    range:           string
    slot_uri:        dcterms:description
    required:        false

  resource_hash:
    description:     Hash of resource 
    range:           string
    required:        true
    
  resource_path:
    description:     Path or URI of resource
    range:           string
    required:        true
    
  schema_path:
    description:     Path or URI of schema associated with resource
    broad_mappings:  linkml:path
    range:           string
    required:        true

  table:
    description:     Table description of a given resource, specifically matching the `atomic_name' field of a given instance of the `TableDesc' class.
    range:           string
    pattern:         "^:?[a-z]+[[a-z]|_|]*$"
    required:        true
    
  scope:
    description: >-
      Columns or dimensions of a given resource, which should be brought
      into the scope of a given context. Typical use of this list is to
      auto-generate a set of jobs or operations from this list, or to
      permit a set of manually-specified jobs or operations to use one or
      more of those listed.
    range:           string
    multivalued:     true
    inlined:         false
    inlined_as_list: false
    required:        true
    #list_elements_ordered: true
    
  #job_type:
  #  description:     Job type
  #  range:           string
  #  required:        true
  #  designates_type: true

  tables:
    description:     Specification of mappings between resources and schemas, as well as columns or dimensions to bring into into scope
    multivalued:     true
    inlined:         true
    inlined_as_list: true
    range:           TableDesc
    required:        true
    #list_elements_ordered: true
    
  jobs:
    description:     Specification of operations to run on resources and schemas provided
    multivalued:     true
    inlined:         true
    inlined_as_list: true
    range:           JobDesc
    required:        true
    #list_elements_ordered: true
    
  gcp_source:
    description:     GCP account of the generator of the manifest
    range:           string
    required:        false
  local_version:
    description:     Version number of local submission utility
    range:           string
    required:        false
    narrow_mappings: pav:version

classes:

  TableDesc:
    description: >-
      Job manifest: data source descriptive attributes
    slots:
      - atomic_name
      - title
      - description
      - resource_path
      - schema_path
      - resource_hash
      - scope

  SourceDesc:
    description: >-
      Job manifest: data-set and column selection attributes
    slots:
      - atomic_name
      - table
      - scope
                
  JobDesc:
    description: >-
      Job manifest: job specification attributes which specific job sub-classes inherit
    slots:
      - atomic_name
      - title

  JobDummy:
    is_a:        JobDesc
    description: >-
      A 'dummy' job which will never be run. For a simple test job, try mean absolute error (MAE).
    attributes:
      columns:
        description:       A set of columns
        range:             string
        multivalued:       true
      
  JobMAE:
    is_a:        JobDesc
    description: >-
      Mean absolute error (MAE): compare modelled and observed values of a series
    attributes:
      collected_columns:
        description:       Names of input columns containing collected or observed values
        range:             string
        multivalued:       true
        required:          true
      modelled_columns:
        description:       Names of input columns containing modelled or simulated values
        range:             string
        multivalued:       true
        required:          true

  JobDensity:
    is_a:        JobDesc
    description: >-
      Prediction of sea lice count given cage data, lice density and time series
    attributes:
      cage_table:
        description:       Name of table which describes the cage data file
        range:             string
        required:          true
      cage_column:
        description:       Name of column in cage table containing cage data
        range:             string
        required:          true
      density_table:
        description:       Name of table which describes the density data file
        range:             string
        required:          true
      density_column:
        description:       Name of column in density table containing density data
        range:             string
        required:          true
      density_time_column:
        description:       Name of column in density table containing time data
        range:             string
        required:          true
      
  ManifestDesc:
    description: >-
      Job manifest: complete specification
    slots:
      - atomic_name
      - tables
      - jobs
      - gcp_source
      - local_version
