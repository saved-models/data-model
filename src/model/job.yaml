# Initial hypothetical type of job:
#
# 1. A dummy manifest which defines some set of data. This is identical
#    to our current use-case of `fisdat'/`fisup' to submit data to GCP.
#
# Unlike manifests which actually verify data *against* well-defined
# schemata, the job manifest is explicitly data in and of itself,
# verified against this schema. The aim is to generate JSON-LD or RDF
# from this schema + manifest, which is then processed by the RAP.
#
# Here is what the LinkML documentation says:
# [https://linkml.io/linkml/faq/general.html#is-linkml-just-for-metadata]
#
#' "LinkML doesn’t draw any hard and fast distinction between data and
#' metadata, recognizing that “metadata” is often defined in relative
#' terms."
#
id: http://localhost/saved/job/
name: job
title: >-
  SAVED data model: job template specification
prefixes:
  linkml: https://w3id.org/linkml/
  saved:  http://localhost/saved/
imports:
  - linkml:types
  - linkml:datasets
default_prefix: saved

slots:

  atomic_name:
    description: >-
      Short-form name / atom: lower-case, no special characters excepting underscores
    range:          string
    broad_mappings:
                    - saved:name
                    - dc:title
    pattern:        "^:?[a-z]+[[a-z]|_|]*$"
    exact_mappings: dc:identifier
    required:       true
  
  schema_path:
    description:    Path or URI of schema associated with a resource
    broad_mappings: linkml:path
    range:          string
    required:       true
    
  scope:
    description: >-
      Columns or dimensions of a given resource, which should be brought
      into the scope of a given context. Typical use of this list is to
      auto-generate a set of jobs or operations from this list, or to
      permit a set of manually-specified jobs or operations to use one or
      more of those listed.
    range:          string
    multivalued:    true
    required:       true
  
  job_type:
    description:    Job type code
    range:          string
    pattern:        "^:?[a-z]+[[a-z]|_|]*$"
    required:       true
    
  job_auto_generate:
    description:    Auto-generate job based on job type/ID and projected columns
    range:          boolean
    required:       true
    
  job_sources:
    description:    Tables and columns from which to generate a job
    range:          SourceDesc
    required:       true
    
classes:

  TableDesc:
    description: >-
      Job manifest: data source descriptive attributes
    slots:
      - title
      - atomic_name
      - description
      - path
      - schema_path
      - hash
      - scope
      
  JobDesc:
    description: >-
      Job manifest: job specification attributes
    slots:
      - title
      - atomic_name
      - job_type
      - job_auto_generate
      - job_sources
      
  SourceDesc:
    description: >-
      Job manifest: data-set and column selection attributes
    slots:
      - atomic_name
      - scope
      
  ManifestDesc:
    description: >-
      Job manifest: complete specification
    attributes:
      tables:
        description:     Specification of mappings between resources and schemas, as well as columns or dimensions to bring into into scope
        multivalued:     true
        inlined:         true
        inlined_as_list: true
        range:           TableDesc
        required:        true
      gcp_source:
        description:     GCP account of the generator of the manifest
        range:           string
        required:        false
      local_version:
        description:     Version number of local submission utility
        range:           string
        required:        false
      jobs:
        description:     Specification of operations to run on resources and schemas provided
        multivalued:     true
        inlined:         true
        inlined_as_list: true
        range:           JobDesc
        required:        true
