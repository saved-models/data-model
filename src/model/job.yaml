# Initial hypothetical type of job:
#
# 1. A dummy manifest which defines some set of data. This is identical
#    to our current use-case of `fisdat'/`fisup' to submit data to GCP.
#
# Unlike manifests which actually verify data *against* well-defined
# schemata, the job manifest is explicitly data in and of itself,
# verified against this schema. The aim is to generate JSON-LD or RDF
# from this schema + manifest, which is then processed by the RAP.
#
# Here is what the LinkML documentation says:
# [https://linkml.io/linkml/faq/general.html#is-linkml-just-for-metadata]
#
#' "LinkML doesn’t draw any hard and fast distinction between data and
#' metadata, recognizing that “metadata” is often defined in relative
#' terms."
#
id: http://localhost/saved/job/
name: job
title: >-
  SAVED data model: job template specification
prefixes:
  dc:      http://purl.org/dc/elements/1.1/
  dcterms: http://purl.org/dc/terms/
  linkml:  https://w3id.org/linkml/
  pav:     http://purl.org/pav/
  saved:   http://localhost/saved/
imports:
  - linkml:types
default_prefix: saved
default_range:  string  

slots:
  
  atomic_name:
    description: >-
      Short-form name / atom: lower-case, no special characters excepting underscores
    range:          string
    broad_mappings:
                    - saved:name
                    - dc:title
    pattern:        "^:?[a-z]+[[a-z]|_|]*$"
    exact_mappings: dc:identifier
    identifier:     true
    required:       true

  # Not from linkml:types, only in linkml:meta and linkml:datasets
  # Note, linkml:datasets is *not* imported by linkml:meta
  #
  # These are essentially duplicates of terms in Dublin Core,
  # so it is fairly reasonable to duplicate these here too, instead of importing
  # the entire linkml:meta or linkml:datasets
  #
  # Further emphasise once again that job.yaml is being used as the
  # schema for our job manifests, see comment at top of file.
  title:
    description: >-
      A concise human-readable display label for the element. The title should mirror the name,
      and should use ordinary textual punctuation.
    range:          string
    slot_uri:       dcterms:title

  description:
    description:    Human-readable description of the information
    range:          string
    slot_uri:       dcterms:description
    required:       false

  resource_hash:
    description:    Hash of resource 
    range:          string
    required:       true
    
  resource_path:
    description:    Path or URI of resource
    range:          string
    required:       true
    
  schema_path:
    description:    Path or URI of schema associated with resource
    broad_mappings: linkml:path
    range:          string
    required:       true

  table:
    description:    Table description of a given resource, specifically matching the `atomic_name' field of a given instance of the `TableDesc' class.
    range:          string
    pattern:        "^:?[a-z]+[[a-z]|_|]*$"
    required:       true
    
  scope:
    description: >-
      Columns or dimensions of a given resource, which should be brought
      into the scope of a given context. Typical use of this list is to
      auto-generate a set of jobs or operations from this list, or to
      permit a set of manually-specified jobs or operations to use one or
      more of those listed.
    range:          string
    multivalued:    true
    required:       true
  
  job_type:
    description:    Job type code
    range:          string
    pattern:        "^:?[a-z]+[[a-z]|_|]*$"
    required:       true
    
  job_auto_generate:
    description:    Auto-generate job based on job type/ID and projected columns
    range:          boolean
    required:       true
    
  job_sources:
    description:    Tables and columns from which to generate a job
    range:          SourceDesc
    multivalued:    true
    inlined:         true
    inlined_as_list: true
    required:       true

  tables:
    description:     Specification of mappings between resources and schemas, as well as columns or dimensions to bring into into scope
    multivalued:     true
    inlined:         true
    inlined_as_list: true
    range:           TableDesc
    required:        true
  jobs:
    description:     Specification of operations to run on resources and schemas provided
    multivalued:     true
    inlined:         true
    inlined_as_list: true
    range:           JobDesc
    required:        true
  gcp_source:
    description:     GCP account of the generator of the manifest
    range:           string
    required:        false
  local_version:
    description:     Version number of local submission utility
    range:           string
    required:        false
    narrow_mappings: pav:version

classes:

  TableDesc:
    description: >-
      Job manifest: data source descriptive attributes
    slots:
      - atomic_name
      - title
      - description
      - resource_path
      - schema_path
      - resource_hash
      - scope

  SourceDesc:
    description: >-
      Job manifest: data-set and column selection attributes
    slots:
      - atomic_name
      - table
      - scope
                
  JobDesc:
    description: >-
      Job manifest: job specification attributes
    slots:
      - atomic_name
      - title
      - job_type
      - job_auto_generate
      - job_sources
      
  ManifestDesc:
    description: >-
      Job manifest: complete specification
    slots:
      - atomic_name
      - tables
      - jobs
      - gcp_source
      - local_version
